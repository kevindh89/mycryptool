{% extends 'base.html.twig' %}

{% block body %}
    <div class="alert my-2" role="alert">
        The list of closed orders is not real-time synced with GDAX.
        <a onclick="reloadTradeList();" class="btn btn-dark mx-2">Collect latest closed orders</a>
    </div>

    <div id="trade-list">
        {{ render(controller('App\\Controller\\FrontendController::tradeList')) }}
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}

    <script type="text/javascript">
        function reloadTradeList() {
            var tradeListElement = $('#trade-list');
            tradeListElement.html('<div class="text-center"><i class="fa fa-spinner fa-3x fa-pulse"></i></div>');

            MyCryptool.updateTrades()
                .then(function () {
                    MyCryptool.loadTradeList(tradeListElement);
                });
        }

        function updateTradeListActiveProductPrice(event) {
            var tradeListPossibleTradePrice = $('#trade-list-possible-trade-current-price');
            var tradeListPossibleTotalTradePrice= $('#trade-list-possible-trade-current-total-price');

            if (isNaN(parseFloat(JSON.parse(event.data).price))) {
                return;
            }
            tradeListPossibleTradePrice.html(parseFloat(JSON.parse(event.data).price).toFixed(2));
            tradeListPossibleTotalTradePrice.html((parseFloat(JSON.parse(event.data).price) * parseFloat($('#trade-list-possible-trade-size').html())).toFixed(2));
        }

        window.MyCryptool.subscribeToTickerWebsocket(updateTradeListActiveProductPrice);
    </script>
{% endblock %}